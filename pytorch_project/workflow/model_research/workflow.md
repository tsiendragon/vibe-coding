# 深度模型研究工作流

专门用于深度研究AI模型的完整工作流程，适用于Flux Kontex等复杂模型的理论和实现分析。

## 工作流概述

这个工作流设计用于系统性地研究AI模型，通过理论学习、代码分析、概念验证等多种方式建立完整的知识体系。核心特点是**理论与代码相互印证**的迭代式研究方法。

## 专属Agent: Model Researcher

使用专门的模型研究员Agent (`agent-model-researcher.md`)，具备：
- 网页搜索和信息收集能力
- 代码分析和理解能力  
- 概念建模和知识管理能力
- 文档生成和组织能力

## 详细工作流阶段

### Phase 1: 研究启动和资料收集

#### 1.1 接收研究任务
**Agent**: Model Researcher  
**输入**: 用户指定的模型名称和初始资料  
**任务**: 建立研究框架和目标

**执行步骤**:
1. 创建研究目录结构
```bash
mkdir -p research/[model_name]/{architecture/modules,concepts,implementations/{official,community},resources/{papers,blogs,videos,code_repos}}
```

2. 初始化核心文档
```bash
cp docs/templates/RESEARCH/model_overview_template.md research/[model_name]/overview.md
cp docs/templates/RESEARCH/research_log_template.md research/[model_name]/research_log.md
```

3. 设定研究目标和时间表

#### 1.2 多源资料收集
**任务**: 全面收集相关资料

**执行步骤**:
1. **处理用户提供资料**
   - 整理用户提供的论文、博客、代码链接
   - 分类存放到 `resources/` 对应子目录
   - 建立资源索引

2. **主动搜索补充资料**
   - ARXIV搜索: `[model_name] arxiv:cs.CV OR arxiv:cs.LG`
   - GitHub搜索: `[model_name] language:Python`
   - 知乎搜索: `[model_name] 详解 OR 解读`
   - 技术博客搜索: `[model_name] blog tutorial`

3. **资料质量评估**
   - 官方资料 > 同行评议 > 技术博客 > 个人笔记
   - 记录资料的可信度和重要性

**输出文档**: 
- `resources/resource_index.md` - 资源索引
- `research_log.md` - 更新研究日志

---

### Phase 2: 概念预理解

#### 2.1 快速概览
**任务**: 快速浏览所有资料，建立初步印象

**执行步骤**:
1. **论文快速扫描**
   - 阅读Abstract, Introduction, Conclusion
   - 识别核心概念和创新点
   - 标记不理解的术语

2. **代码仓库结构分析**
   - 分析目录结构和主要文件
   - 识别入口函数和核心模块
   - 查看README和文档

3. **建立概念清单**
   - 列出所有遇到的专业概念
   - 标记理解程度 (理解/部分理解/不理解)
   - 识别核心概念和依赖概念

**输出文档**:
- `concepts/concept_inventory.md` - 概念清单
- `overview.md` - 更新模型概览

#### 2.2 概念依赖分析
**任务**: 分析概念间的依赖关系

**执行步骤**:
1. **构建概念图谱**
   - 识别前置概念 (prerequisite concepts)
   - 分析概念间的逻辑关系
   - 确定学习顺序

2. **制定学习路径**
   - 从基础概念到高级概念
   - 理论学习与代码验证并行

**输出文档**:
- `concepts/concept_dependency.md` - 概念依赖图

---

### Phase 3: 深度迭代研究 (核心阶段)

这是最关键的阶段，采用**三个并行循环**相互印证的方式：

#### 3.1 理论学习循环

**循环目标**: 深度理解每个核心概念

**单次循环流程**:
1. **选择目标概念**
   - 选择一个待深入理解的概念
   - 优先选择依赖较少的基础概念

2. **多源信息收集**
   ```bash
   # 搜索概念相关资料
   WebSearch: "[concept] definition explanation"
   WebSearch: "[concept] arxiv papers"
   WebSearch: "[concept] implementation code"
   ```

3. **深度理解**
   - 数学定义和公式推导
   - 直观解释和应用场景
   - 历史发展和改进过程

4. **概念文档创建**
   ```bash
   cp docs/templates/RESEARCH/concept_analysis_template.md research/[model_name]/concepts/[concept].md
   # 填写详细的概念分析
   ```

**循环结束条件**: 能够清晰解释概念并回答相关问题

#### 3.2 代码验证循环

**循环目标**: 通过代码实现验证和深化理论理解

**单次循环流程**:
1. **代码定位**
   - 在官方实现中找到概念对应的代码
   - 分析代码的组织结构和实现方式

2. **代码分析**
   ```python
   # 详细分析关键函数
   def analyze_function(func_name, file_path):
       # 理解函数的输入输出
       # 分析算法实现逻辑
       # 对比理论描述
   ```

3. **理论验证**
   - 代码实现是否与理论一致？
   - 是否有工程上的优化或简化？
   - 是否有理论中未提到的实现细节？

4. **差异分析**
   - 记录理论与实现的差异
   - 分析差异的原因 (性能/工程/简化)
   - 更新理论理解

**循环结束条件**: 理论与代码实现完全对应，无不一致之处

#### 3.3 架构细分循环

**循环目标**: 递归分析模型架构，直到最小功能单元

**单次循环流程**:
1. **选择分析目标**
   - 从整体模型开始
   - 逐层选择子模块进行细分

2. **模块分析**
   ```bash
   cp docs/templates/RESEARCH/module_analysis_template.md research/[model_name]/architecture/modules/[module].md
   ```
   
   分析内容:
   - 模块的功能和设计目的
   - 输入输出规格
   - 内部子模块结构
   - 与其他模块的关系

3. **递归细分**
   - 如果模块仍然复杂，继续细分
   - 直到达到最小功能单元 (单个操作或函数)

4. **关系理解**
   - 理解模块间的数据流
   - 分析控制流和依赖关系

**循环结束条件**: 所有模块都细分到可完全理解的程度

### 三循环协调机制

**相互印证**: 
- 理论学习 ↔ 代码验证: 理论指导代码理解，代码验证理论正确性
- 理论学习 ↔ 架构分析: 概念应用于具体模块，模块设计印证概念理解  
- 代码验证 ↔ 架构分析: 模块代码实现验证架构设计，架构指导代码阅读

**动态调整**:
- 在代码中发现新概念 → 启动理论学习循环
- 理论理解有疑问 → 查找对应代码验证  
- 模块理解困难 → 深入相关概念学习

---

### Phase 4: 知识整合与验证

#### 4.1 整体一致性检查
**任务**: 验证所有理解是否形成一致的整体

**执行步骤**:
1. **概念一致性**
   - 检查概念间定义是否矛盾
   - 验证概念关系是否正确

2. **架构一致性**  
   - 验证模块间接口是否匹配
   - 检查数据流是否完整

3. **理论实现一致性**
   - 确认所有理论都有对应实现
   - 验证实现符合理论预期

#### 4.2 知识盲点识别
**任务**: 发现仍不清楚的问题

**执行步骤**:
1. **系统性检查**
   - 遍历所有概念和模块
   - 识别理解不充分的部分

2. **深度验证测试**
   - 尝试回答关键问题
   - 进行思维实验验证理解

3. **补充研究**
   - 针对盲点进行额外研究
   - 更新相关文档

---

### Phase 5: 文档生成与总结

#### 5.1 完善文档体系
**任务**: 生成完整、结构化的知识库

**执行步骤**:
1. **文档完整性检查**
   - 确保所有概念都有对应文档
   - 验证所有模块都有详细分析

2. **文档质量提升**
   - 添加示例和图表
   - 完善文档间的交叉引用
   - 统一术语和格式

3. **生成总结报告**
   - 更新 `overview.md` 为最终版本
   - 完善 `research_log.md` 
   - 创建 `research_summary.md`

#### 5.2 知识可复用性
**任务**: 为后续研究和应用做准备

**执行步骤**:
1. **提取通用知识**
   - 识别可重用的概念和方法
   - 更新通用知识库

2. **生成复现指南**
   - 编写模型复现步骤
   - 提供关键代码解释

3. **制作应用指导**
   - 总结模型的适用场景
   - 提供使用建议和注意事项

---

## 文档关系和管理

### 文档层次结构
```
research/[model_name]/
├─ overview.md                    # 顶层总览 (汇总所有理解)
├─ research_log.md               # 过程记录 (研究轨迹)
├─ research_summary.md           # 最终总结 (研究成果)
├─ architecture/
│  ├─ overall_design.md         # 整体架构 (引用各模块)
│  └─ modules/[module].md       # 模块分析 (引用相关概念)
├─ concepts/[concept].md        # 概念分析 (被模块引用)
├─ implementations/
│  └─ code_analysis.md          # 代码分析 (验证概念和模块)
└─ resources/
   └─ resource_index.md         # 资源索引 (支撑所有分析)
```

### 文档间关系
```
overview.md (总览)
    ↓ 总结
architecture/overall_design.md
    ↓ 分解为
architecture/modules/*.md
    ↓ 依赖
concepts/*.md
    ↓ 验证于
implementations/code_analysis.md
    ↓ 记录于
research_log.md
```

### 文档更新机制
- **实时更新**: research_log.md 每日更新
- **阶段更新**: 概念和模块文档在理解确认后更新
- **总结更新**: overview.md 在整合阶段统一更新
- **版本控制**: 使用Git跟踪所有文档变化

## 质量保证

### 研究完成标准
- [ ] 所有核心概念都有详细文档且理解程度>90%
- [ ] 所有主要模块都完成递归细分到最小单元
- [ ] 理论与代码实现100%对应，无不一致
- [ ] 能够独立复现模型的关键部分
- [ ] 建立了完整的知识库供后续参考

### 理解验证方法
1. **概念测试**: 能够回答概念相关的任何问题
2. **代码追踪**: 能够追踪数据在代码中的完整流动
3. **模块重构**: 能够用不同方式重新组织模块实现同样功能
4. **问题诊断**: 能够分析和解决模型中可能出现的问题

### 文档质量标准
- **准确性**: 所有信息都经过多源验证
- **完整性**: 覆盖模型的所有重要方面
- **可理解性**: 使用清晰的语言和丰富的示例
- **可维护性**: 结构清晰，便于更新和扩展

## 工具和技术支持

### 必需工具
- **WebSearch**: 搜索最新论文和技术资料
- **WebFetch**: 获取和分析网页内容
- **Code Analysis**: 代码阅读和分析工具
- **Documentation**: Markdown文档编写和管理

### 推荐实践
1. **时间管理**: 每个概念/模块分配固定时间，避免过度深入
2. **进度跟踪**: 定期评估研究进度，调整计划
3. **知识验证**: 定期回顾已理解的内容，确保记忆牢固
4. **经验总结**: 记录有效的研究方法，提高效率

## 常见挑战和解决方案

### 概念理解困难
**症状**: 某个概念反复阅读仍不理解
**解决方案**: 
1. 寻找更基础的解释资料
2. 查找具体的代码实现
3. 寻找类比和可视化解释
4. 暂时跳过，从相关概念开始

### 理论与代码不一致
**症状**: 论文描述与代码实现有差异
**解决方案**:
1. 查找官方说明或issues
2. 分析是否为工程优化
3. 查看多个实现版本对比
4. 记录差异并说明原因

### 信息过载
**症状**: 资料太多，不知从何开始
**解决方案**:
1. 优先处理官方和权威资料
2. 建立资料重要性评级
3. 制定每日学习计划
4. 定期整理和归档

### 进度缓慢
**症状**: 研究进展太慢，效率低下
**解决方案**:
1. 设定每日最小目标
2. 采用番茄工作法集中注意力
3. 优先理解核心概念
4. 记录和分析时间分配

---

**研究成功的关键**: 保持理论学习、代码分析、架构理解三者的平衡，通过相互印证来深化理解，最终建立完整、准确、可应用的知识体系。